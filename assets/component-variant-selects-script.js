!function(){class t extends HTMLElement{constructor(){super(),this.url=this.getAttribute("url")||"",this.currentVariant=null,this.section=this.getAttribute("section")||"",this.variants=JSON.parse(this.getAttribute("variants")),this.optionsElements=Array.from(this.querySelectorAll("select")),this.optionsElements.forEach((t=>{t.addEventListener("change",this.onOptionChange.bind(this))}))}getCurrentVariant(){const t=this.optionsElements.map((t=>t.value));return this.variants.find((e=>e.options.every((e=>t.includes(e)))))}onOptionChange(t){this.currentVariant=this.getCurrentVariant(),this.toggleAddButton(!0,"Cargando","-disabled"),this.removeErrorMessage(),this.currentVariant.available?(this.updateURL(),this.updateVariantInput(),this.renderProductInfo()):(this.updateURL(),this.setUnavailable())}updateURL(){this.currentVariant&&window.history.replaceState({},"",`${this.url}?variant=${this.currentVariant.id}`)}updateVariantInput(){document.querySelectorAll(`#product-form-${this.section}, #product-form-installment`).forEach((t=>{const e=t.querySelector('input[name="id"]');e.value=this.currentVariant.id,e.dispatchEvent(new Event("change",{bubbles:!0}))}))}removeErrorMessage(){const t=this.closest("section");if(!t)return;const e=t.querySelector("product-form");e&&e.handleErrorMessage(!this.currentVariant&&"No disponible")}toggleAddButton(t=!0,e,r){const n=document.getElementById(`product-form-${this.section}`);if(!n)return;const i=n.querySelector('button[name="add"]');i&&(t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled"),r&&(t?i.classList.add(r):i.classList.remove(r),e))&&(i.querySelector("span").textContent=e)}setUnavailable(){const t=document.getElementById(`product-form-${this.section}`),e=t.querySelector('[name="add"]'),r=t.querySelector('[name="add"] > span'),n=document.getElementById(`price-${this.dataset.section}`);e&&(r.textContent="Agotado",n&&n.classList.add("u-hide"))}renderProductInfo(){fetch(`${this.url}?variant=${this.currentVariant.id}&section_id=${this.section}`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html"),r=document.querySelector(`#shopify-section-${this.section} .product_content`),n=e.querySelector(`#shopify-section-${this.section} .product_content`);r&&n&&(r.querySelector(".product_price").innerHTML=n.querySelector(".product_price").innerHTML,this.toggleAddButton(!1,this.currentVariant.available?"Agregar al carrito":"Agotado","-disabled"))}))}}customElements.define("variant-selects",t)}();